PROCEDURE ZAKLAD;
BEGIN
#A
PORTA EQU 54016
PORTCNTL EQU 54018

BAJT DB 0
DOBA1 DB 4
DOBA2 DB 128

KROK LDA BAJT
  STA PORTA
  AND #253
  STA PORTA
  ORA #254
  STA PORTA
  STA BAJT
  JSR PAUZA1
  RTS

PAUZA1 TYA
  PHA
  LDY DOBA1
PAU1 DEY
  BNE PAU1
  PLA
  TAY
  RTS

PAUZA2 TYA
  PHA
  LDY DOBA2
  BNE PAU1

VODOR LDA BAJT
  AND #251
VODOR1 STA BAJT
  RTS

VERT LDA BAJT
  ORA #4
  BNE VODOR1

VLENA LDA BAJT
  AND #247
VLENA1 STA BAJT
  RTS

VPRDOL LDA BAJT
  ORA #8
  BNE VLENA1

#
END;

PROCEDURE OPENXY;
BEGIN
#A
  LDA #56
  STA PORTCNTL
  LDA #255
  STA PORTA
  LDA #60
  STA PORTCNTL
  LDA #254
  STA PORTA
  STA BAJT
#
END;

PROCEDURE CLOSEXY;
BEGIN
#A
  LDA #56
  STA PORTCNTL
  LDA #0
  STA PORTA
  LDA #60
  STA PORTCNTL
#
END;

PROCEDURE PENUP;
BEGIN
#A
  LDA BAJT
  AND #254
  STA BAJT
  STA PORTA
  JSR PAUZA2
#
END;

PROCEDURE PENDOWN;
BEGIN
#A
  LDA BAJT
  ORA #1
  STA BAJT
  STA PORTA
  JSR PAUZA2
#
END;

PROCEDURE VPRED;
BEGIN
#A
  JSR VERT
  JSR VLENA
  JSR KROK
#
POSY:=POSY+1;
END;

PROCEDURE VZAD;
BEGIN
#A
  JSR VERT
  JSR VPRDOL
  JSR KROK
#
POSY:=POSY-1;
END;

PROCEDURE VLEVO;
BEGIN
#A
  JSR VODOR
  JSR VLENA
  JSR KROK
#
POSX:=POSX-1;
END;

PROCEDURE VPRAVO;
BEGIN
#A
  JSR VODOR
  JSR VPRDOL
  JSR KROK
#
POSX:=POSX+1;
END;

PROCEDURE INIT;
VAR I:INTEGER;
BEGIN
 OPENXY;
 FOR I:=1 TO 2000 DO
 BEGIN
  VLEVO;
 END;
 POSX:=0;POSY:=2600;
END;

 
PROCEDURE HORIZ(DXX:REAL);
BEGIN
IF DXX<>0 THEN
BEGIN
IF DXX>0 THEN
VPRAVO
ELSE
VLEVO;
END
END;

PROCEDURE SVISLE(DYY:REAL);
BEGIN
IF DYY<>0 THEN
BEGIN
IF DYY>0 THEN
VPRED
ELSE
VZAD;
END
END;

PROCEDURE MR(DX,DY:REAL);
VAR DXX,DYY,K,Y,YP:REAL;

 PROCEDURE POM1;
 VAR X:INTEGER;
 BEGIN
  K:=DX/DY;YP:=0;X:=1;
  REPEAT
   Y:=K*X;SVISLE(DYY);X:=X+1;
   IF (Y-YP)>0.5 THEN
   BEGIN
    HORIZ(DXX);YP:=YP+1;
   END;
  UNTIL X>DY;
 END;
 
 PROCEDURE POM2;
 VAR X:INTEGER;
 BEGIN
  K:=DY/DX;YP:=0;X:=1;
  REPEAT
   Y:=K*X;HORIZ(DXX);X:=X+1;
   IF (Y-YP)>0.5 THEN
   BEGIN
    SVISLE(DYY);YP:=YP+1;
   END;
  UNTIL X>DX;
 END;

BEGIN
 DXX:=DX;DYY:=DY;
 DX:=ABS(DX);DY:=ABS(DY);
 DX:=ROUND(DX);DY:=ROUND(DY);
 IF DY>DX THEN
  POM1
 ELSE
  POM2
END;

PROCEDURE MA(XX,YY:REAL);
VAR DX,DY:REAL;
BEGIN
 DX:=XX-POSX;DY:=YY-POSY;
 MR(DX,DY)
END;